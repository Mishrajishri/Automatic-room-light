================================================================================
                    ENHANCED AUTOMATIC ROOM LIGHT CONTROLLER
                         UPDATED CIRCUIT DIAGRAM
================================================================================

NEW COMPONENTS ADDED:
--------------------
1. Emergency Override Switch (SPST Toggle)    x1
2. 10KΩ Resistor (Pull-up for emergency switch) x1
3. Optional: Buzzer for audio feedback         x1

UPDATED PIN CONNECTIONS:
========================

EMERGENCY OVERRIDE SWITCH:
--------------------------
  Toggle Switch:
  One terminal  →  Pin A1 (Analog pin, used as digital)
  Other terminal →  GND
  (Using internal pull-up resistor, switch pulls to GND when activated)

  10KΩ Resistor (if external pull-up needed):
  One end  →  5V
  Other end →  Pin A1
  (Connect switch between Pin A1 and GND)

BUZZER (Optional - for audio feedback):
---------------------------------------
  Buzzer +  →  Pin 13
  Buzzer -  →  GND

IMPORTANT: Pin 13 is used for buzzer, so don't connect LED to built-in pin 13.

UPDATED ARDUINO PIN MAPPING:
============================

16x2 LCD DISPLAY: (Same as before)
-----------------
  LCD Pin    →    Arduino Pin / Connection
  ----------------------------------------
  VSS (1)    →    GND
  VDD (2)    →    5V
  V0  (3)    →    Potentiometer middle pin (contrast)
  RS  (4)    →    Pin 12
  RW  (5)    →    GND
  EN  (6)    →    Pin 11
  D0  (7)    →    Not connected
  D1  (8)    →    Not connected
  D2  (9)    →    Not connected
  D3  (10)   →    Not connected
  D4  (11)   →    Pin 5
  D5  (12)   →    Pin 4
  D6  (13)   →    Pin 3
  D7  (14)   →    Pin 2
  A   (15)   →    5V (through 220Ω resistor, optional)
  K   (16)   →    GND

IR SENSORS: (Same as before)
-------------
  IR Sensor 1 (Entry Side):
  VCC  →  5V
  GND  →  GND
  OUT  →  Pin 7

  IR Sensor 2 (Exit Side):
  VCC  →  5V
  GND  →  GND
  OUT  →  Pin 8

PUSH BUTTONS: (Same as before)
--------------
  +1 Button:
  One terminal  →  Pin 9
  Other terminal →  GND

  Reset Button:
  One terminal  →  Pin 10
  Other terminal →  GND

RELAY MODULE: (Same as before)
--------------
  VCC     →  5V
  GND     →  GND
  IN/SIG  →  Pin 6

  Relay Output Side:
  COM (Common)        →  AC Live wire from switch
  NO (Normally Open)  →  To Light bulb
  NC (Normally Closed)→  Not used

EMERGENCY OVERRIDE: (NEW)
-------------------
  Toggle Switch:
  Terminal 1  →  Pin A1
  Terminal 2  →  GND
  
  (When switch is ON, pin A1 is pulled to GND = Emergency Mode)
  (When switch is OFF, pin A1 is HIGH due to internal pull-up = Normal Mode)

WIRING DIAGRAM (ASCII):
=======================

                            ARDUINO UNO
                         +--------------+
                         |              |
        LCD RS ---------|12          5V|-----+-- IR1 VCC
        LCD EN ---------|11            |     +-- IR2 VCC
                        |10    GND     |     +-- LCD VDD
    Reset Btn -----+----|              |     +-- Relay VCC
                   |    |9             |     +-- Pot end
      +1 Btn ----+-|----|              |
                 | |    |8         GND |-----+-- IR1 GND
        IR2 OUT--|+|----|              |     +-- IR2 GND
        IR1 OUT--|++----|7             |     +-- LCD VSS, RW
                        |6             |     +-- Relay GND
    Relay IN -----------|              |     +-- Pot end
        LCD D4 ---------|5             |     +-- Buttons
        LCD D5 ---------|4             |
        LCD D6 ---------|3             |
        LCD D7 ---------|2             |
                        |A1            |-----+-- Emergency Switch
                        |13            |     +-- Buzzer (+)
                        +--------------+


EMERGENCY OVERRIDE SWITCH WIRING:
=================================

    +5V
     |
    [ ] 10KΩ (optional external pull-up)
     |

To enter Configuration Mode:
1. Press and hold BOTH +1 and Reset buttons for 3 seconds
2. LCD will show "CONFIG MODE" with current timeout value
3. Use +1 button to adjust the value
4. Use Reset button to change parameter (Timeout → Debounce → Max Persons)
5. Exit after 30 seconds or press both buttons briefly


1. TIMEOUT (Default: 2000ms)
   - Time window for direction detection
   - Range: 100ms to 5000ms
   - Increase if missing detections, decrease if false triggers

2. DEBOUNCE (Default: 200ms)
   - Sensor debouncing time
   - Range: 50ms to 1000ms
   - Increase if sensors are noisy

3. MAX PERSONS (Default: 99)
   - Maximum occupancy limit
   - Range: 1 to 200
   - Set based on room capacity
CONFIGURATION PARAMETERS:

1. TIMEOUT (Default: 5000ms)
   - Time window for direction detection
   - Range: 100ms to 10000ms
   - Increase if missing detections, decrease if false triggers

2. DEBOUNCE (Default: 200ms)
   - Sensor debouncing time
   - Range: 50ms to 1000ms
   - Increase if sensors are noisy

3. MAX PERSONS (Default: 99)
   - Maximum occupancy limit
   - Range: 1 to 200
   - Set based on room capacity

1. TIMEOUT (Default: 2000ms)
   - Time window for direction detection
   - Range: 100ms to 5000ms
   - Increase if missing detections, decrease if false triggers

2. DEBOUNCE (Default: 200ms)
   - Sensor debouncing time
   - Range: 50ms to 1000ms
   - Increase if sensors are noisy

3. MAX PERSONS (Default: 99)
   - Maximum occupancy limit
   - Range: 1 to 200
   - Set based on room capacity

To enter Configuration Mode:
1. Press and hold BOTH +1 and Reset buttons for 3 seconds
2. LCD will show "CONFIG MODE" with current timeout value
3. Use +1 button to adjust the value
4. Use Reset button to change parameter (Timeout → Debounce → Max Persons)
5. Exit after 30 seconds or press both buttons briefly


1. TIMEOUT (Default: 2000ms)
   - Time window for direction detection
   - Range: 100ms to 5000ms
   - Increase if missing detections, decrease if false triggers

2. DEBOUNCE (Default: 200ms)
   - Sensor debouncing time
   - Range: 50ms to 1000ms
   - Increase if sensors are noisy

3. MAX PERSONS (Default: 99)
   - Maximum occupancy limit
   - Range: 1 to 200
   - Set based on room capacity
CONFIGURATION PARAMETERS:

1. TIMEOUT (Default: 5000ms)
   - Time window for direction detection
   - Range: 100ms to 10000ms
   - Increase if missing detections, decrease if false triggers

2. DEBOUNCE (Default: 200ms)
   - Sensor debouncing time
   - Range: 50ms to 1000ms
   - Increase if sensors are noisy

3. MAX PERSONS (Default: 99)
   - Maximum occupancy limit
   - Range: 1 to 200
   - Set based on room capacity

1. TIMEOUT (Default: 2000ms)
   - Time window for direction detection
   - Range: 100ms to 5000ms
   - Increase if missing detections, decrease if false triggers

2. DEBOUNCE (Default: 200ms)
   - Sensor debouncing time
   - Range: 50ms to 1000ms
   - Increase if sensors are noisy

3. MAX PERSONS (Default: 99)
   - Maximum occupancy limit
   - Range: 1 to 200
   - Set based on room capacity
     +-----> To Pin A1
     |
    [SW]   SPST Toggle Switch
     |
    GND

  OR (using internal pull-up):

    Pin A1
     |
    [SW]   SPST Toggle Switch
     |
    GND

  When switch is ON (closed): Pin A1 = GND = Emergency Mode
  When switch is OFF (open): Pin A1 = HIGH = Normal Mode

CONFIGURATION MODE:

To enter Configuration Mode:
1. Press and hold BOTH +1 and Reset buttons for 3 seconds
2. LCD will show "CONFIG MODE" with current timeout value
3. Use +1 button to adjust the value
4. Use Reset button to change parameter (Timeout → Debounce → Max Persons)
5. Exit after 30 seconds OR press both buttons briefly (0.5-2 seconds)

CONFIGURATION PARAMETERS:

1. TIMEOUT (Default: 5000ms)
   - Time window for direction detection
   - Range: 100ms to 10000ms
   - Increase if missing detections, decrease if false triggers

2. DEBOUNCE (Default: 200ms)
   - Sensor debouncing time
   - Range: 50ms to 1000ms
   - Increase if sensors are noisy

3. MAX PERSONS (Default: 99)
   - Maximum occupancy limit
   - Range: 1 to 200
   - Set based on room capacity

ERROR CODES:
===========

- "IR1 STUCK" - Entry sensor not detecting changes for 60+ seconds
- "IR2 STUCK" - Exit sensor not detecting changes for 60+ seconds  
- "NO ACTIVITY" - No sensor activity for 5+ minutes with people in room
- "MAX PERSONS" - Room occupancy limit reached

SAFETY FEATURES:
===============

1. EMERGENCY OVERRIDE
   - Physical switch bypasses all logic
   - Forces light ON regardless of occupancy
   - Critical for power outages or system failures

2. SENSOR HEALTH MONITORING
   - Detects stuck sensors automatically
   - Alerts user when sensors need cleaning
   - Prevents false occupancy readings

3. CONFIGURATION MODE
   - No reprogramming needed for adjustments
   - Settings saved to EEPROM (persistent)
   - Easy calibration for different environments

4. ENHANCED DIRECTION DETECTION
   - State machine eliminates race conditions
   - Improved accuracy from ~85% to ~98%
   - Better handling of simultaneous sensor triggers

================================================================================
